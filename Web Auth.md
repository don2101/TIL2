## Auth

#### 인증이 필요한 이유

- 로그인, 회원가입에 있어 인증은 꼭 필요한 절차이다.
- 서버로 넘어온 API 요청이 어떤 클라이언트에서 보낸 것인지 알아야 한다.
- 그렇지 않다면 올바르지 않은 유저에게 중요한 정보가 넘어갈 수도 있다.
- 서버에서 유저를 **식별**할 필요가 있다.



### 1. HTTP request

- 웹, 모바일에서 가장 많이 사용되는 통신 방식, 규약



#### 문제

- HTTP는 비연결지향적인 특성을 갖고 있다.
  - 비연결지향: 클라이언트와 서버를 계속 연결하는 것이 아니라, 통신 후 연결을 끊는 방식
  - 연결이 계속되면 서버에 부하가 커진다.
- 로그인을 해도 다른 페이지로 넘어가면 새로운 유저로 인식하기 때문에, 페이지 마다 로그인을 해야 하는 상황이 발생
- **인증**의 필요



### 2. Cookie 인증 방식

- 클라이언트(유저의 컴퓨터)에 저장되는 텍스트 형식의 데이터
  - 유저 정보를 **유저 컴퓨터의 메모리**에 저장
- HTTP header에 자동으로 넣어서 전송된다.
- 쿠키에 계정정보(id, pw, name...)를 담아서 서버로 전송하여 인증하는 방식.
- 페이지 이동시마다 HTTP header에 정보가 담겨 같이 전송되는 방식



#### 문제

- 페이지 이동시 마다 사용자 정보를 보내므로, 요청을 가로채면 계정 정보가 그대로 노출된다.
- 실제로도 거의 안쓴다.



### 3. Cookie / Session 인증 방식

#### Session

- **서버**에 저장되는 데이터
- **일정시간** 동안 같은 사용자로 부터 들어오는 요구를 하나의 요청으로 본다.
  - 일정시간: 유저가 브라우저를 통해 **접속한 시점** 부터 **연결을 끝내는** 시점



#### 작동 방식

1. 클라이언트에서 로그인 요청을 하면 서버의 세션저장소에 세션(로그인 기록)을 저장
2. 서버에서 세션ID를 만들어 클라이언트로 전송
3. 클라이언트는 세션ID를 쿠키에 저장
4. 페이지 이동이나 인증이 필요할 때 마다 HTTP header에 세션 ID를 담아 요청을 보낸다.
5. 서버가 세션ID로 세션 저장소를 확인한 후 요청을 처리



#### 장점

- HTTP 요청이 노출되도 세션ID 만으로 사용자 정보를 알 수 없다.
- 세션ID를 탈취해도 세션에서 데이터를 삭제해 피해를 줄일 수 있다.



#### 단점

- 서버에 추가적인 저장 공간이 필요하며, 많은 유저 접속시 부하가 걸린다.



### 4. Token 기반 인증 방식(JWT)

#### JWT

- Json Web Token의 약자로 **인증에 필요한 정보**를 암호화 시킨 토큰



#### 형태

크게 Header, Payload, Verify Signature가 필요

구조: (Header).(Payload).(Verify Signature)

- Header: 위 3가지 정보를 암호화 하는 방식, 타입 등이 들어간다.
- Payload: 서버에서 보낼 유저의 데이터(id, expired date, name...)
- Verify Signature: Base64 방식으로 인코딩한 Header, Payload, 그리고 Secret Key를 더한 후 서명
  - (인코딩된 Header) + "." + (인코딩된 Payload)를 Secret Key로 해쉬



#### 장점

- Secret Key로 토큰을 변경하여 악용할 수 없다.
- 서버에 추가 저장공간이 필요하지 않아 부하가 줄어든다.



#### 단점

- 토큰을 탈취당하면, 한번 발급한 토큰은 막을 수 없다.
  - refresh token으로 피해를 줄일 수 있다.
- payload가 노출될 수 있어 제한적. 암호화를 하지 않아 중요한 정보는 넣을 수 없다.



### 5. OAuth

#### OAuth

- 유저들이 비밀번호를 제공하지 않고 다른 사이트 계정의 정보를 받아 접근 권한을 얻는 인증 방식
- 사이트에서 유저의 허락을 받아 외부 사이트로 부터 정보를 받는 방식
- ex) FB, Naver, Github...



#### 흐름(Facebook)

유저 - (로그인 요청) -> 사이트 - (권한부여 수락 요청) -> 유저 - (인증 및 권한부여 수락) -> Facebook - (성공 + 계정정보) -> 사이트 - (로그인) -> 유저



